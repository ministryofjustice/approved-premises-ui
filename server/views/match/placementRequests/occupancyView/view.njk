{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "./partials/_occupancySummary.njk" import occupancySummary %}
{% from "./partials/_occupancyCalendar.njk" import occupancyCalendar %}
{% from "../../../partials/showErrorSummary.njk" import showErrorSummary %}

{% extends "../../layout-with-details.njk" %}

{% set pageTitle = applicationName + " - " + pageHeading %}

{% block beforeContent %}
    {{ govukBackLink({
        text: "Back to other APs",
        href: paths.v2Match.placementRequests.search.spaces({ id: placementRequest.id })
    }) }}
{% endblock %}

{% block content %}
    {{ showErrorSummary(errorSummary) }}

    <h1 class="govuk-heading-l">{{ pageHeading }}</h1>

    {{ occupancySummary(summary) }}
    {% call govukDetails({summaryText: "Placement request information", open: false}) %}
        {{ govukSummaryList(placementRequestInfoSummaryList) }}
    {% endcall %}

    <section>
        <form action="{{ currentUrl }}" method="post">
            <input type="hidden" name="_csrf" value="{{ csrfToken }}" />

            <h3 class="govuk-heading-m">Confirm booking requirements</h3>

            {{ govukDateInput({
                id: "arrivalDate",
                namePrefix: "arrivalDate",
                fieldset: {
                    legend: {
                        text: "Check-in date",
                        classes: "govuk-fieldset__legend--s"
                    }
                },
                items: dateFieldValues('arrivalDate', errors),
                errorMessage: errors.arrivalDate
            }) }}

            {{ govukDateInput({
                id: "departureDate",
                namePrefix: "departureDate",
                fieldset: {
                    legend: {
                        text: "Check-out date",
                        classes: "govuk-fieldset__legend--s"
                    }
                },
                items: dateFieldValues('departureDate', errors),
                errorMessage: errors.departureDate
            }) }}

            {{ govukSummaryList(durationSummary) }}

            {{ govukCheckboxes({
                name: "roomCriteria",
                classes: "govuk-checkboxes--small",
                fieldset: {
                    legend: {
                        text: "Room requirements",
                        classes: "govuk-fieldset__legend--s"
                    }
                },
                items: criteriaOptions
            }) }}


            {{ govukButton({
                text: 'Update booking requirements',
                classes: "govuk-button--secondary",
                preventDoubleClick: true
            }) }}
        </form>

        {% if not errors.startDate %}
            {% call govukDetails({summaryText: "Occupancy calendar", open: false}) %}
            <section id="calendar-key">
                <h3 class="govuk-heading-m">Key</h3>

                <ul class="calendar__month govuk-list">
                    <li class="calendar__day">
                        Available
                    </li>
                    <li class="calendar__day govuk-tag--yellow">
                        Can be overbooked
                    </li>
                    <li class="calendar__day govuk-tag--red">
                        Not available
                    </li>
                </ul>
            </section>

            <section aria-describedby="calendar-key">
                {{ occupancyCalendar(calendar) }}
            </section>
            {% endcall %}
        {% endif %}
    </section>

    {% if not errors.startDate %}
        <section>
            <form action="{{ paths.v2Match.placementRequests.search.occupancyBook({ id: placementRequest.id, premisesId: premises.id }) }}"
                  method="post">
                <input type="hidden" name="_csrf" value="{{ csrfToken }}" />

                <input type="hidden" name="criteria" value="{{ criteria }}" />
                <input type="hidden" name="arrivalDate" value="{{ arrivalDate }}">
                <input type="hidden" name="departureDate" value="{{ departureDate }}">

                <div class="govuk-button-group">
                    {{ govukButton({
                        text: "Book placement",
                        preventDoubleClick: true
                    }) }}
                </div>
            </form>
            <h3 class="govuk-heading-m">If you are not booking this placement</h3>
            <p class="govuk-body">
                <a href="{{ paths.v2Match.placementRequests.search.spaces({ id: placementRequest.id }) }}">Check for a
                    space at another AP</a>
            </p>
            <p class="govuk-body">
                <a href="{{ paths.placementRequests.bookingNotMade.confirm({id: placementRequest.id}) }}">Mark as unable
                    to match</a>
            </p>
        </section>
    {% endif %}
{% endblock %}
